{"version":3,"sources":["main.js"],"names":["masks","$","mask","calc","cart","totalPriceNode","document","querySelector","totalGetPrice","totalPrice","parseInt","innerText","subTotalPriceNode","taxNode","taxGetPrice","taxPrice","shippingNode","shippingGetPrice","shippingPrice","dataArr","dataArrInit","getData","productCardNodes","querySelectorAll","forEach","productCardNode","itemId","getAttribute","cardObj","cardObjInit","number","priceNode","priceNumber","id","push","counterNode","btnMinus","btnPlus","numberNode","addEventListener","countPlus","countMinus","btnRemove","removeItem","itemIdNode","closest","filter","x","isNegativeNumber","itemNode","itemRemoveIndex","findIndex","splice","parentElement","remove","getSingleItemPrice","itemIdInit","quantity","singleItemPrice","itemSumm","productPrices","item","isArrayEmpty","length","productsSum","reduce","total","amount","orderSumm","SP","body","ESC_CODE","siteContent","isIe11","window","MSInputMethodContext","documentMode","classList","add","getCoords","elem","box","getBoundingClientRect","top","pageYOffset","left","pageXOffset","top_walker","node","test_func","last_parent","parentNode","getSiblings","siblings","sibling","firstChild","nodeType","nextSibling"],"mappings":"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","file":"main.js","sourcesContent":["const masks = () => {\r\n  $('.js-card-4').mask('0000');\r\n  $('.js-card-3').mask('000');\r\n  $('.js-date').mask('00/00');\r\n};\r\n\r\nconst calc = () => {\r\n  const cart =\r\n  {\r\n    totalPriceNode: document.querySelector('.js-total-price'),\r\n    totalGetPrice: () => {\r\n      cart.totalPrice = parseInt(cart.totalPriceNode.innerText);\r\n    },\r\n    subTotalPriceNode: document.querySelector('.js-subtotal-price'),\r\n    taxNode: document.querySelector('.js-tax-price'),\r\n    taxGetPrice: () => {\r\n      cart.taxPrice = parseInt(cart.taxNode.innerText);\r\n    },\r\n    shippingNode: document.querySelector('.js-shipping-price'),\r\n    shippingGetPrice: () => {\r\n      cart.shippingPrice = parseInt(cart.shippingNode.innerText)\r\n    },\r\n    dataArr: [],\r\n    dataArrInit: [],\r\n    getData: () => {\r\n      // Получение данных при загрузке страницы\r\n      cart.taxGetPrice();\r\n      cart.shippingGetPrice();\r\n      cart.totalGetPrice();\r\n      \r\n      const productCardNodes = document.querySelectorAll('.js-product-card');\r\n      productCardNodes.forEach((productCardNode) => {\r\n        const itemId = productCardNode.getAttribute('data-id');\r\n        const cardObj = {};\r\n        const cardObjInit = {};\r\n        const number = parseInt(productCardNode.querySelector('.js-number').innerText);\r\n        const priceNode = productCardNode.querySelector('.js-card-price');\r\n        const priceNumber = parseInt(priceNode.innerText);\r\n        cardObj.number = number;\r\n        cardObj.priceNumber = priceNumber;\r\n        cardObj.id = itemId;\r\n        cart.dataArr.push(cardObj);\r\n\r\n        cardObjInit.number = number;\r\n        cardObjInit.priceNumber = priceNumber;\r\n        cardObjInit.id = itemId;\r\n        cart.dataArrInit.push(cardObjInit);\r\n\r\n        // события на каунтере\r\n        const counterNode = productCardNode.querySelector('.js-counter');\r\n        const btnMinus = counterNode.querySelector('.js-minus');\r\n        const btnPlus = counterNode.querySelector('.js-plus');\r\n        const numberNode = counterNode.querySelector('.js-number');\r\n\r\n        btnPlus.addEventListener('click', () => {\r\n          cart.countPlus(numberNode, priceNode);\r\n        });\r\n\r\n        btnMinus.addEventListener('click', () => {\r\n          cart.countMinus(numberNode, priceNode);\r\n        });\r\n\r\n        // события на remove кнопке\r\n        const btnRemove = productCardNode.querySelector('.js-btn-cancel');\r\n        btnRemove.addEventListener('click', () => {\r\n          cart.removeItem(productCardNode);\r\n        });\r\n      });\r\n    },\r\n    countPlus: (numberNode, priceNode) => {\r\n      const itemIdNode = numberNode.closest('.js-product-card').getAttribute('data-id');\r\n      const itemId = cart.dataArr.filter(x => x.id === itemIdNode);\r\n      itemId[0].number++;\r\n      numberNode.innerText = itemId[0].number;\r\n      cart.calc(itemId, priceNode, itemIdNode);\r\n    },\r\n    countMinus: (numberNode, priceNode) => {\r\n      const itemIdNode = numberNode.closest('.js-product-card').getAttribute('data-id');\r\n      const itemId = cart.dataArr.filter(x => x.id === itemIdNode);\r\n      itemId[0].number--;\r\n      const isNegativeNumber = itemId[0].number < 1;\r\n\r\n      if (isNegativeNumber) {\r\n        itemId[0].number = 1;\r\n      }\r\n\r\n      numberNode.innerText = itemId[0].number;\r\n      cart.calc(itemId, priceNode, itemIdNode);\r\n    },\r\n    removeItem: (itemNode) => {\r\n      const itemIdNode = itemNode.getAttribute('data-id');\r\n      const itemRemoveIndex = cart.dataArr.findIndex(x => x.id === itemIdNode);\r\n      cart.dataArr.splice(itemRemoveIndex, 1);\r\n      itemNode.parentElement.remove();\r\n      cart.calc(itemIdNode);\r\n    },\r\n    calc: (itemId, priceNode, itemIdNode) => {\r\n      if (priceNode) {\r\n        // обновить цену одного товара\r\n        const getSingleItemPrice = (itemIdNode) => {\r\n          const itemIdInit = cart.dataArrInit.filter(x => x.id === itemIdNode);\r\n          const quantity = itemIdInit[0].number;\r\n          const priceNumber = itemIdInit[0].priceNumber;\r\n          const singleItemPrice = priceNumber / quantity;\r\n\r\n          return singleItemPrice;\r\n        };\r\n\r\n        const singleItemPrice = getSingleItemPrice(itemIdNode);\r\n        const itemSumm = singleItemPrice * itemId[0].number;\r\n        itemId[0].priceNumber = itemSumm;\r\n        priceNode.innerText = itemId[0].priceNumber;\r\n      }\r\n\r\n      // обновить итоговую стоимость продуктов\r\n      let productPrices = [];\r\n      productPrices = [];\r\n      cart.dataArr.forEach((item) => {\r\n        const singleItemPrice = item.priceNumber;\r\n        productPrices.push(singleItemPrice);\r\n      });\r\n      const isArrayEmpty = productPrices.length === 0;\r\n\r\n      if (isArrayEmpty) {\r\n        cart.subTotalPriceNode.innerText = '0';\r\n        cart.totalPriceNode.innerText = cart.taxPrice + cart.shippingPrice;\r\n      } else {\r\n        cart.productsSum = productPrices.reduce((total, amount) => total + amount);\r\n        cart.subTotalPriceNode.innerText = cart.productsSum;\r\n\r\n        // обновить общую стоимость товаров с учетём налога и доставки\r\n        cart.orderSumm = cart.productsSum + cart.taxPrice + cart.shippingPrice;\r\n        cart.totalPriceNode.innerText = cart.orderSumm;\r\n      }\r\n    }\r\n  };\r\n\r\n  cart.getData();\r\n};\r\nconst SP = {};\r\nSP.body = document.querySelector('body');\r\nSP.ESC_CODE = 27;\r\nSP.siteContent = document.querySelector('.site-content');\r\nSP.isIe11 = !!window.MSInputMethodContext && !!document.documentMode;\r\n\r\n\r\nif(SP.isIe11){\r\n  SP.body.classList.add('ie11');\r\n}\r\n\r\nfunction getCoords(elem) {\r\n  let box = elem.getBoundingClientRect();\r\n\r\n  return {\r\n    top: box.top + pageYOffset,\r\n    left: box.left + pageXOffset\r\n  };\r\n}\r\n\r\nfunction top_walker (node, test_func, last_parent) {\r\n\twhile ( node && node !== last_parent ) {\r\n\t\tif ( test_func(node) ) {\r\n\t\t\treturn node;\r\n\t\t}\r\n\t\tnode = node.parentNode;\r\n\t}\r\n}\r\n\r\n// siblings\r\nvar getSiblings = function (elem) {\r\n  var siblings = [];\r\n  var sibling = elem.parentNode.firstChild;\r\n\r\n  while (sibling) {\r\n    if (sibling.nodeType === 1 && sibling !== elem) {\r\n      siblings.push(sibling);\r\n    }\r\n    sibling = sibling.nextSibling\r\n  }\r\n\r\n  return siblings;\r\n\r\n};\r\n\r\n// utility\r\nmasks();\r\ncalc();\r\n\r\n// specific\r\n\r\n"]}